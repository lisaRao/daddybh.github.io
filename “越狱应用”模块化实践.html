<html>
<head>
  <title>Evernote Export</title>
  <basefont face="Tahoma" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/271698; Windows/6.1.7601 Service Pack 1;"/>
  <style>
    body, td {
      font-family: Tahoma;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="620"/>

<div><div lang="v2" style="line-height:1.6;"><del style="position:relative;display:block"><a href="http://maxiang.info/#/?provider=evernote_int&guid=84066ef7-f5c3-4c12-8918-9cc05b6c1781" style="position: absolute;color: #FFF;text-decoration: none;font-size: 12px;height: 25px;border-radius: 0;margin-top: -30px;right: 15px;background: rgba(0, 0, 0, 0);border-left: 10px solid #BB3A34;border-right: 10px solid #BB3A34;border-bottom: 5px solid rgba(0, 0, 0, 0);width: 0;"></a></del><div style="line-height: 1.6; font-family: Helvetica Neue, Arial, Hiragino Sans GB, STHeiti, SimSun, WenQuanYi Micro Hei, Microsoft YaHei, sans-serif;"><h1 style="font-size: 36px; margin: 0.67em 0; font-family: Helvetica Neue, Arial, Hiragino Sans GB, STHeiti, Microsoft YaHei, WenQuanYi Micro Hei, SimSun, sans-serif; font-weight: bold; line-height: 1.1; color: inherit; margin-top: 0px; margin-bottom: 20px;">&quot;越狱应用&quot;模块化实践</h1>
<h2 style="font-family: Helvetica Neue, Arial, Hiragino Sans GB, STHeiti, Microsoft YaHei, WenQuanYi Micro Hei, SimSun, sans-serif; font-weight: bold; line-height: 1.1; color: inherit; margin-top: 30px; margin-bottom: 20px; font-size: 30px;">概述</h2>
<hr style="-moz-box-sizing: content-box; box-sizing: content-box; height: 0; line-height: 1.6; margin-top: 20px; margin-bottom: 20px; border: 0; border-top: 1px solid rgba(102, 128, 153, 0.15);"/>
<p style="margin: 0 0 10px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;">根据之前模块化分享，尝试将&quot;越狱应用&quot;及PP正版按模块划分<br/>本文档描述该项目模块化形式</p>
<h2 style="font-family: Helvetica Neue, Arial, Hiragino Sans GB, STHeiti, Microsoft YaHei, WenQuanYi Micro Hei, SimSun, sans-serif; font-weight: bold; line-height: 1.1; color: inherit; margin-top: 30px; margin-bottom: 20px; font-size: 30px;">模块划分</h2>
<hr style="-moz-box-sizing: content-box; box-sizing: content-box; height: 0; line-height: 1.6; margin-top: 20px; margin-bottom: 20px; border: 0; border-top: 1px solid rgba(102, 128, 153, 0.15);"/>
<ul style="margin-top: 0; margin-bottom: 10px; line-height: 1.6;">
<li style="line-height: 1.6;">根据pp正版与越狱应用页面逻辑，按照业务划分为<code style="font-family: Menlo, Monaco, Consolas, Courier New, monospace; font-size: 90%; padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: nowrap; border-radius: 4px;">首页模块</code>，<code style="font-family: Menlo, Monaco, Consolas, Courier New, monospace; font-size: 90%; padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: nowrap; border-radius: 4px;">应用页模块</code>，<code style="font-family: Menlo, Monaco, Consolas, Courier New, monospace; font-size: 90%; padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: nowrap; border-radius: 4px;">搜索模块</code>，<code style="font-family: Menlo, Monaco, Consolas, Courier New, monospace; font-size: 90%; padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: nowrap; border-radius: 4px;">应用详情</code>，<code style="font-family: Menlo, Monaco, Consolas, Courier New, monospace; font-size: 90%; padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: nowrap; border-radius: 4px;">主题</code>，<code style="font-family: Menlo, Monaco, Consolas, Courier New, monospace; font-size: 90%; padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: nowrap; border-radius: 4px;">主题详情</code></li>
<li style="line-height: 1.6;">抽取<code style="font-family: Menlo, Monaco, Consolas, Courier New, monospace; font-size: 90%; padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: nowrap; border-radius: 4px;">通用模块</code>, DeviceInfo.js, AppInfo.js, UserInfo.js, iosHelper.js, dataService.js, appCommon.js等</li>
<li style="line-height: 1.6;">使用arttemplate.js作为模板引擎, 渲染界面元素</li>
<li style="line-height: 1.6;">业务逻辑按照<code style="font-family: Menlo, Monaco, Consolas, Courier New, monospace; font-size: 90%; padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: nowrap; border-radius: 4px;">main.js -&gt; *Controller.js -&gt; *View.js</code>流程<ul style="margin-top: 0; margin-bottom: 0; line-height: 1.6;">
<li style="line-height: 1.6;"><code style="font-family: Menlo, Monaco, Consolas, Courier New, monospace; font-size: 90%; padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: nowrap; border-radius: 4px;">main.js</code> 处理hash变化，调用相应Controller的loadData方法，Controller调用view生成界面html</li>
<li style="line-height: 1.6;"><code style="font-family: Menlo, Monaco, Consolas, Courier New, monospace; font-size: 90%; padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: nowrap; border-radius: 4px;">**Controller.js</code>，负责加载数据，处理业务逻辑</li>
<li style="line-height: 1.6;"><code style="font-family: Menlo, Monaco, Consolas, Courier New, monospace; font-size: 90%; padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: nowrap; border-radius: 4px;">**View.js</code>, 负责渲染模板，处理界面样式</li>
</ul>
</li>
</ul>
<p style="margin: 0 0 10px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;"><img src="“越狱应用”模块化实践_files/.structure.jpg" type="image/jpeg" alt="Alt text" longdesc="./structure.jpg" style="border: 0; max-width: 100%;"/></p>
<h2 style="font-family: Helvetica Neue, Arial, Hiragino Sans GB, STHeiti, Microsoft YaHei, WenQuanYi Micro Hei, SimSun, sans-serif; font-weight: bold; line-height: 1.1; color: inherit; margin-top: 30px; margin-bottom: 20px; font-size: 30px;">业务流程</h2>
<p style="margin: 0 0 10px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;">目前PP正版与越狱应用，由于重复代码较多，因此两个页面整合在一起iosV2，通过resType做差异化判断</p>
<ol style="margin-top: 0; margin-bottom: 10px; line-height: 1.6;">
<li style="line-height: 1.6;">main.js 应用入口<br/> 从该文件名可以看出，此文件是应用的唯一入口（也即jquery的ready事件），改文件做以下几个事情<ul style="margin-top: 0; margin-bottom: 0; line-height: 1.6;">
<li style="line-height: 1.6;">处理hashchange事件，调用各个Controller的loadData方法，加载数据</li>
<li style="line-height: 1.6;">绑定全局事件、委托，比如刷新按钮，前进后退按钮，以及其它公共的委托（比如安装，下载，收藏按钮等）</li>
</ul>
</li>
</ol>
<ol style="margin-top: 0; margin-bottom: 10px; line-height: 1.6;">
<li style="line-height: 1.6;"><p style="margin: 0 0 10px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;">Controller.js 控制器<br/> Controller其实与MVC的Controller完全没有关系，只是命名如此，相关的Controller文件其实只是作一些数据加载工作<br/> 然后调用对于的View渲染页面</p>
</li>
<li style="line-height: 1.6;"><p style="margin: 0 0 10px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;">View.js 视图文件<br/> View.js相关文件，通过Controller传递过来的实体类，根据模板生成html，渲染到页面上</p>
</li>
</ol>
<h2 style="font-family: Helvetica Neue, Arial, Hiragino Sans GB, STHeiti, Microsoft YaHei, WenQuanYi Micro Hei, SimSun, sans-serif; font-weight: bold; line-height: 1.1; color: inherit; margin-top: 30px; margin-bottom: 20px; font-size: 30px;">公用模块(Common/js)</h2>
<p style="margin: 0 0 10px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;">公用模板有： <code style="font-family: Menlo, Monaco, Consolas, Courier New, monospace; font-size: 90%; padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: nowrap; border-radius: 4px;">DeviceInfo.js</code>, <code style="font-family: Menlo, Monaco, Consolas, Courier New, monospace; font-size: 90%; padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: nowrap; border-radius: 4px;">AppInfo.js</code>, <code style="font-family: Menlo, Monaco, Consolas, Courier New, monospace; font-size: 90%; padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: nowrap; border-radius: 4px;">UserInfo.js</code>, <code style="font-family: Menlo, Monaco, Consolas, Courier New, monospace; font-size: 90%; padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: nowrap; border-radius: 4px;">iosHelper.js</code>, <code style="font-family: Menlo, Monaco, Consolas, Courier New, monospace; font-size: 90%; padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: nowrap; border-radius: 4px;">dataService.js</code>, <code style="font-family: Menlo, Monaco, Consolas, Courier New, monospace; font-size: 90%; padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: nowrap; border-radius: 4px;">appCommon.js</code>, <code style="font-family: Menlo, Monaco, Consolas, Courier New, monospace; font-size: 90%; padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: nowrap; border-radius: 4px;">pwi.jsListener.js</code></p>
<p style="margin: 0 0 10px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;"><code style="font-family: Menlo, Monaco, Consolas, Courier New, monospace; font-size: 90%; padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: nowrap; border-radius: 4px;">DeviceInfo.js</code> 类，提供静态方法(getDeviceList)，统一获取设备接口，提供两个实例接口(hasUpdate, hasInstallApp)获取是否安装某个应用</p>
<pre style="overflow: initial; font-family: Menlo, Monaco, Consolas, Courier New, monospace; font-size: 14px; display: block; padding: 0; margin: 0 0 10px; line-height: 1.6; word-break: break-all; word-wrap: break-word; color: #333333; background-color: #f5f5f5; border: none; border-radius: 0; white-space: pre-wrap;"><code style="font-family: Menlo, Monaco, Consolas, Courier New, monospace; font-size: inherit; padding: 0.5em; color: #f8f8f2; background-color: transparent; white-space: pre-wrap; border-radius: 0; display: block; background: #23241f;">    <span style="color: #F92672;">var</span> devices = DeviceInfo.getDeviceList();
    devices[<span style="color: #ae81ff;">0</span>].hasUpdate(buid, version);
    devices[<span style="color: #ae81ff;">0</span>].hasInstallApp(buid);
    alert(devices[<span style="color: #ae81ff;">0</span>].uuid);
    alert(devices[<span style="color: #ae81ff;">0</span>].name);
    alert(devices[<span style="color: #ae81ff;">0</span>].apps.length);
</code></pre>
<p style="margin: 0 0 10px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;"><code style="font-family: Menlo, Monaco, Consolas, Courier New, monospace; font-size: 90%; padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: nowrap; border-radius: 4px;">AppInfo.js</code> 类，用于应用管理，提供统一的接口，方便其它模块调用，使用方法如下:</p>
<pre style="overflow: initial; font-family: Menlo, Monaco, Consolas, Courier New, monospace; font-size: 14px; display: block; padding: 0; margin: 0 0 10px; line-height: 1.6; word-break: break-all; word-wrap: break-word; color: #333333; background-color: #f5f5f5; border: none; border-radius: 0; white-space: pre-wrap;"><code style="font-family: Menlo, Monaco, Consolas, Courier New, monospace; font-size: inherit; padding: 0.5em; color: #f8f8f2; background-color: transparent; white-space: pre-wrap; border-radius: 0; display: block; background: #23241f;">    <span style="color: #F92672;">var</span> apps = AppInfo.getAppList(rawData, <span style="color: #F92672;"><span style="color: #66d9ef;">function</span><span style="color: #f8f8f2;">()</span></span>{
                <span style="color: #F92672;">this</span>.appid = <span style="color: #F92672;">this</span>.id;
                <span style="color: #F92672;">this</span>.resUrl = <span style="color: #F92672;">this</span>.downurl;
                <span style="color: #F92672;">this</span>.name = <span style="color: #F92672;">this</span>.title;
                <span style="color: #F92672;">this</span>.appType = <span style="color: #F92672;">this</span>.resType;<span style="color: #75715e;">//软件类型，标示软件/游戏等</span>
                <span style="color: #F92672;">this</span>.resType = restype.jbApp;<span style="color: #75715e;">//越狱应用</span>
            });
    <span style="color: #F92672;">var</span> app = <span style="color: #F92672;">new</span> AppInfo(rawData, <span style="color: #F92672;"><span style="color: #66d9ef;">function</span><span style="color: #f8f8f2;">()</span></span>{
                <span style="color: #F92672;">this</span>.appid = <span style="color: #F92672;">this</span>.id;
                <span style="color: #F92672;">this</span>.resUrl = <span style="color: #F92672;">this</span>.downurl;
                <span style="color: #F92672;">this</span>.name = <span style="color: #F92672;">this</span>.title;
                <span style="color: #F92672;">this</span>.appType = <span style="color: #F92672;">this</span>.resType;<span style="color: #75715e;">//软件类型，标示软件/游戏等</span>
                <span style="color: #F92672;">this</span>.resType = restype.jbApp;<span style="color: #75715e;">//越狱应用</span>
            });
    app.donwload();
    app.cancel();
    app.pause();
</code></pre>
<p style="margin: 0 0 10px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;"><code style="font-family: Menlo, Monaco, Consolas, Courier New, monospace; font-size: 90%; padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: nowrap; border-radius: 4px;">UserInfo.js</code>类，处理用户相关逻辑，比如：收藏应用，获取收藏列表，获取下载列表等</p>
<p style="margin: 0 0 10px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;"><code style="font-family: Menlo, Monaco, Consolas, Courier New, monospace; font-size: 90%; padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: nowrap; border-radius: 4px;">dataService.js</code>模块，此模块为正版应用，越狱应用提供调用ppAjax.run的统一接口，每个接口都有对于的单元测试<code style="font-family: Menlo, Monaco, Consolas, Courier New, monospace; font-size: 90%; padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: nowrap; border-radius: 4px;">dataService.test.html</code><br/>该模块使用jquery Promise功能，所有接口均返回promise对象，支持链式调用<br/>调用方法如下：</p>
<pre style="overflow: initial; font-family: Menlo, Monaco, Consolas, Courier New, monospace; font-size: 14px; display: block; padding: 0; margin: 0 0 10px; line-height: 1.6; word-break: break-all; word-wrap: break-word; color: #333333; background-color: #f5f5f5; border: none; border-radius: 0; white-space: pre-wrap;"><code style="font-family: Menlo, Monaco, Consolas, Courier New, monospace; font-size: inherit; padding: 0; color: inherit; background-color: transparent; white-space: pre-wrap; border-radius: 0;">    dataService.loadAppAmount(3)
        .done(render)
        .fail(failed);

    dataService.loadApps(opts);
</code></pre><p style="margin: 0 0 10px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;"><code style="font-family: Menlo, Monaco, Consolas, Courier New, monospace; font-size: 90%; padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: nowrap; border-radius: 4px;">iosHelper.js</code>模块，相当于一个工具箱，提供页面调用的通用接口，比如: fBuildPageBar， timestampToDate，showLoading类</p>
<p style="margin: 0 0 10px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;"><code style="font-family: Menlo, Monaco, Consolas, Courier New, monospace; font-size: 90%; padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: nowrap; border-radius: 4px;">appCommon.js</code> 模块，此模块主要是业务相关的一些通用函数，以及通用数据，将会保存到这个类，它提供一些通用事件绑定等。</p>
<p style="margin: 0 0 10px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;"><code style="font-family: Menlo, Monaco, Consolas, Courier New, monospace; font-size: 90%; padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: nowrap; border-radius: 4px;">pwi.jsListener.js</code>通用模块，此文件主要暴露全局函数，将c++程序段回调的函数，转换为js事件，具体使用方法：</p>
<pre style="overflow: initial; font-family: Menlo, Monaco, Consolas, Courier New, monospace; font-size: 14px; display: block; padding: 0; margin: 0 0 10px; line-height: 1.6; word-break: break-all; word-wrap: break-word; color: #333333; background-color: #f5f5f5; border: none; border-radius: 0; white-space: pre-wrap;"><code style="font-family: Menlo, Monaco, Consolas, Courier New, monospace; font-size: inherit; padding: 0.5em; color: #f8f8f2; background-color: transparent; white-space: pre-wrap; border-radius: 0; display: block; background: #23241f;"><span style="color: #F92672;">var</span> jqExt = $(jsListener);
jqExt.on(<span style="color: #e6db74;">&quot;DeviceChanged&quot;</span>, <span style="color: #F92672;"><span style="color: #66d9ef;">function</span><span style="color: #f8f8f2;">()</span></span>{
    <span style="color: #75715e;">// do something</span>
});

<span style="color: #75715e;">// 下载通知事件，回调第一个参数为Event对象，后续的参数才是c++返回值</span>
jqExt.on(<span style="color: #e6db74;">&quot;DownloadStateChanged&quot;</span>, <span style="color: #F92672;"><span style="color: #66d9ef;">function</span><span style="color: #f8f8f2;">()</span></span>{
    <span style="color: #75715e;">// 更新界面按钮样式等...</span>
});
</code></pre>
<h2 style="font-family: Helvetica Neue, Arial, Hiragino Sans GB, STHeiti, Microsoft YaHei, WenQuanYi Micro Hei, SimSun, sans-serif; font-weight: bold; line-height: 1.1; color: inherit; margin-top: 30px; margin-bottom: 20px; font-size: 30px;">模板使用</h2>
<p style="margin: 0 0 10px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;">经过上一次会议讨论，模板使用了arttemplate的simple template语法，详细语法请参考arttemplate github页面<br/>使用tmod grunt插件对模板进行预编译处理<br/>所有template至于common/tpl目录中，根据模块建立相应的子目录<br/>由于模板大同小异，很多模板越狱和正版都是同用的，因此，模板都编译一起，成为一个template.js文件</p>
<h2 style="font-family: Helvetica Neue, Arial, Hiragino Sans GB, STHeiti, Microsoft YaHei, WenQuanYi Micro Hei, SimSun, sans-serif; font-weight: bold; line-height: 1.1; color: inherit; margin-top: 30px; margin-bottom: 20px; font-size: 30px;">优化</h2>
<p style="margin: 0 0 10px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;">此次重构所做的优化包括</p>
<ol style="margin-top: 0; margin-bottom: 10px; line-height: 1.6;">
<li style="line-height: 1.6;">css放在页面头部，js全部放到底部</li>
<li style="line-height: 1.6;">服务器返回index.html的同时就加载ppajax的iframe，而不是dom ready之后加载iframe</li>
<li style="line-height: 1.6;">去除所有document.writeln函数，使$(document).ready事件提前触发，加载页面数据</li>
<li style="line-height: 1.6;">统计代码移动到页面最底部，业务js之后，统计代码不应该影响业务呈现</li>
<li style="line-height: 1.6;">使用Gruntjs, 引入<code style="font-family: Menlo, Monaco, Consolas, Courier New, monospace; font-size: 90%; padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: nowrap; border-radius: 4px;">构建</code>流程，发布正式环境需要对源代码进行构建，具体参考另外一篇文章《grunt实现项目构建》</li>
</ol>
</div><center style="display:none">%22%u8D8A%u72F1%u5E94%u7528%22%u6A21%u5757%u5316%u5B9E%u8DF5%0A%3D%3D%3D%3D%3D%0A%23%23%u6982%u8FF0%0A***%0A%u6839%u636E%u4E4B%u524D%u6A21%u5757%u5316%u5206%u4EAB%uFF0C%u5C1D%u8BD5%u5C06%22%u8D8A%u72F1%u5E94%u7528%22%u53CAPP%u6B63%u7248%u6309%u6A21%u5757%u5212%u5206%0A%u672C%u6587%u6863%u63CF%u8FF0%u8BE5%u9879%u76EE%u6A21%u5757%u5316%u5F62%u5F0F%0A%0A%23%23%u6A21%u5757%u5212%u5206%0A***%0A*%20%u6839%u636Epp%u6B63%u7248%u4E0E%u8D8A%u72F1%u5E94%u7528%u9875%u9762%u903B%u8F91%uFF0C%u6309%u7167%u4E1A%u52A1%u5212%u5206%u4E3A%60%u9996%u9875%u6A21%u5757%60%uFF0C%60%u5E94%u7528%u9875%u6A21%u5757%60%uFF0C%60%u641C%u7D22%u6A21%u5757%60%uFF0C%60%u5E94%u7528%u8BE6%u60C5%60%uFF0C%60%u4E3B%u9898%60%uFF0C%60%u4E3B%u9898%u8BE6%u60C5%60%0A*%20%u62BD%u53D6%60%u901A%u7528%u6A21%u5757%60%2C%20DeviceInfo.js%2C%20AppInfo.js%2C%20UserInfo.js%2C%20iosHelper.js%2C%20dataService.js%2C%20appCommon.js%u7B49%0A*%20%u4F7F%u7528arttemplate.js%u4F5C%u4E3A%u6A21%u677F%u5F15%u64CE%2C%20%u6E32%u67D3%u754C%u9762%u5143%u7D20%0A*%20%u4E1A%u52A1%u903B%u8F91%u6309%u7167%60main.js%20-%3E%20*Controller.js%20-%3E%20*View.js%60%u6D41%u7A0B%0A%20%20%20%20*%20%60main.js%60%20%u5904%u7406hash%u53D8%u5316%uFF0C%u8C03%u7528%u76F8%u5E94Controller%u7684loadData%u65B9%u6CD5%uFF0CController%u8C03%u7528view%u751F%u6210%u754C%u9762html%0A%20%20%20%20*%20%60**Controller.js%60%uFF0C%u8D1F%u8D23%u52A0%u8F7D%u6570%u636E%uFF0C%u5904%u7406%u4E1A%u52A1%u903B%u8F91%0A%20%20%20%20*%20%60**View.js%60%2C%20%u8D1F%u8D23%u6E32%u67D3%u6A21%u677F%uFF0C%u5904%u7406%u754C%u9762%u6837%u5F0F%0A%0A%21%5BAlt%20text%5D%28./structure.jpg%29%0A%0A%23%23%u4E1A%u52A1%u6D41%u7A0B%0A%u76EE%u524DPP%u6B63%u7248%u4E0E%u8D8A%u72F1%u5E94%u7528%uFF0C%u7531%u4E8E%u91CD%u590D%u4EE3%u7801%u8F83%u591A%uFF0C%u56E0%u6B64%u4E24%u4E2A%u9875%u9762%u6574%u5408%u5728%u4E00%u8D77iosV2%uFF0C%u901A%u8FC7resType%u505A%u5DEE%u5F02%u5316%u5224%u65AD%0A%0A1.%20main.js%20%u5E94%u7528%u5165%u53E3%0A%20%20%20%20%u4ECE%u8BE5%u6587%u4EF6%u540D%u53EF%u4EE5%u770B%u51FA%uFF0C%u6B64%u6587%u4EF6%u662F%u5E94%u7528%u7684%u552F%u4E00%u5165%u53E3%uFF08%u4E5F%u5373jquery%u7684ready%u4E8B%u4EF6%uFF09%uFF0C%u6539%u6587%u4EF6%u505A%u4EE5%u4E0B%u51E0%u4E2A%u4E8B%u60C5%0A%20%20%20%20*%20%u5904%u7406hashchange%u4E8B%u4EF6%uFF0C%u8C03%u7528%u5404%u4E2AController%u7684loadData%u65B9%u6CD5%uFF0C%u52A0%u8F7D%u6570%u636E%0A%20%20%20%20*%20%u7ED1%u5B9A%u5168%u5C40%u4E8B%u4EF6%u3001%u59D4%u6258%uFF0C%u6BD4%u5982%u5237%u65B0%u6309%u94AE%uFF0C%u524D%u8FDB%u540E%u9000%u6309%u94AE%uFF0C%u4EE5%u53CA%u5176%u5B83%u516C%u5171%u7684%u59D4%u6258%uFF08%u6BD4%u5982%u5B89%u88C5%uFF0C%u4E0B%u8F7D%uFF0C%u6536%u85CF%u6309%u94AE%u7B49%uFF09%0A%20%20%20%20%0A%0A2.%20Controller.js%20%u63A7%u5236%u5668%0A%20%20%20%20Controller%u5176%u5B9E%u4E0EMVC%u7684Controller%u5B8C%u5168%u6CA1%u6709%u5173%u7CFB%uFF0C%u53EA%u662F%u547D%u540D%u5982%u6B64%uFF0C%u76F8%u5173%u7684Controller%u6587%u4EF6%u5176%u5B9E%u53EA%u662F%u4F5C%u4E00%u4E9B%u6570%u636E%u52A0%u8F7D%u5DE5%u4F5C%0A%20%20%20%20%u7136%u540E%u8C03%u7528%u5BF9%u4E8E%u7684View%u6E32%u67D3%u9875%u9762%0A%0A3.%20View.js%20%u89C6%u56FE%u6587%u4EF6%0A%20%20%20%20View.js%u76F8%u5173%u6587%u4EF6%uFF0C%u901A%u8FC7Controller%u4F20%u9012%u8FC7%u6765%u7684%u5B9E%u4F53%u7C7B%uFF0C%u6839%u636E%u6A21%u677F%u751F%u6210html%uFF0C%u6E32%u67D3%u5230%u9875%u9762%u4E0A%0A%0A%20%20%20%20%0A%23%23%u516C%u7528%u6A21%u5757%28Common/js%29%0A%u516C%u7528%u6A21%u677F%u6709%uFF1A%20%60DeviceInfo.js%60%2C%20%60AppInfo.js%60%2C%20%60UserInfo.js%60%2C%20%60iosHelper.js%60%2C%20%60dataService.js%60%2C%20%60appCommon.js%60%2C%20%60pwi.jsListener.js%60%0A%0A%60DeviceInfo.js%60%20%u7C7B%uFF0C%u63D0%u4F9B%u9759%u6001%u65B9%u6CD5%28getDeviceList%29%uFF0C%u7EDF%u4E00%u83B7%u53D6%u8BBE%u5907%u63A5%u53E3%uFF0C%u63D0%u4F9B%u4E24%u4E2A%u5B9E%u4F8B%u63A5%u53E3%28hasUpdate%2C%20hasInstallApp%29%u83B7%u53D6%u662F%u5426%u5B89%u88C5%u67D0%u4E2A%u5E94%u7528%0A%0A%60%60%60%0A%20%20%20%20var%20devices%20%3D%20DeviceInfo.getDeviceList%28%29%3B%0A%20%20%20%20devices%5B0%5D.hasUpdate%28buid%2C%20version%29%3B%0A%20%20%20%20devices%5B0%5D.hasInstallApp%28buid%29%3B%0A%20%20%20%20alert%28devices%5B0%5D.uuid%29%3B%0A%20%20%20%20alert%28devices%5B0%5D.name%29%3B%0A%20%20%20%20alert%28devices%5B0%5D.apps.length%29%3B%0A%60%60%60%0A%0A%60AppInfo.js%60%20%u7C7B%uFF0C%u7528%u4E8E%u5E94%u7528%u7BA1%u7406%uFF0C%u63D0%u4F9B%u7EDF%u4E00%u7684%u63A5%u53E3%uFF0C%u65B9%u4FBF%u5176%u5B83%u6A21%u5757%u8C03%u7528%uFF0C%u4F7F%u7528%u65B9%u6CD5%u5982%u4E0B%3A%0A%60%60%60%0A%20%20%20%20var%20apps%20%3D%20AppInfo.getAppList%28rawData%2C%20function%28%29%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.appid%20%3D%20this.id%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.resUrl%20%3D%20this.downurl%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.name%20%3D%20this.title%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.appType%20%3D%20this.resType%3B//%u8F6F%u4EF6%u7C7B%u578B%uFF0C%u6807%u793A%u8F6F%u4EF6/%u6E38%u620F%u7B49%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.resType%20%3D%20restype.jbApp%3B//%u8D8A%u72F1%u5E94%u7528%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%29%3B%0A%20%20%20%20var%20app%20%3D%20new%20AppInfo%28rawData%2C%20function%28%29%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.appid%20%3D%20this.id%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.resUrl%20%3D%20this.downurl%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.name%20%3D%20this.title%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.appType%20%3D%20this.resType%3B//%u8F6F%u4EF6%u7C7B%u578B%uFF0C%u6807%u793A%u8F6F%u4EF6/%u6E38%u620F%u7B49%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.resType%20%3D%20restype.jbApp%3B//%u8D8A%u72F1%u5E94%u7528%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%29%3B%0A%20%20%20%20app.donwload%28%29%3B%0A%20%20%20%20app.cancel%28%29%3B%0A%20%20%20%20app.pause%28%29%3B%0A%60%60%60%0A%0A%0A%0A%60UserInfo.js%60%u7C7B%uFF0C%u5904%u7406%u7528%u6237%u76F8%u5173%u903B%u8F91%uFF0C%u6BD4%u5982%uFF1A%u6536%u85CF%u5E94%u7528%uFF0C%u83B7%u53D6%u6536%u85CF%u5217%u8868%uFF0C%u83B7%u53D6%u4E0B%u8F7D%u5217%u8868%u7B49%0A%0A%60dataService.js%60%u6A21%u5757%uFF0C%u6B64%u6A21%u5757%u4E3A%u6B63%u7248%u5E94%u7528%uFF0C%u8D8A%u72F1%u5E94%u7528%u63D0%u4F9B%u8C03%u7528ppAjax.run%u7684%u7EDF%u4E00%u63A5%u53E3%uFF0C%u6BCF%u4E2A%u63A5%u53E3%u90FD%u6709%u5BF9%u4E8E%u7684%u5355%u5143%u6D4B%u8BD5%60dataService.test.html%60%0A%u8BE5%u6A21%u5757%u4F7F%u7528jquery%20Promise%u529F%u80FD%uFF0C%u6240%u6709%u63A5%u53E3%u5747%u8FD4%u56DEpromise%u5BF9%u8C61%uFF0C%u652F%u6301%u94FE%u5F0F%u8C03%u7528%0A%u8C03%u7528%u65B9%u6CD5%u5982%u4E0B%uFF1A%0A%60%60%60%0A%20%20%20%20dataService.loadAppAmount%283%29%0A%20%20%20%20%20%20%20%20.done%28render%29%0A%20%20%20%20%20%20%20%20.fail%28failed%29%3B%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20dataService.loadApps%28opts%29%3B%0A%60%60%60%0A%0A%60iosHelper.js%60%u6A21%u5757%uFF0C%u76F8%u5F53%u4E8E%u4E00%u4E2A%u5DE5%u5177%u7BB1%uFF0C%u63D0%u4F9B%u9875%u9762%u8C03%u7528%u7684%u901A%u7528%u63A5%u53E3%uFF0C%u6BD4%u5982%3A%20fBuildPageBar%uFF0C%20timestampToDate%uFF0CshowLoading%u7C7B%0A%0A%60appCommon.js%60%20%u6A21%u5757%uFF0C%u6B64%u6A21%u5757%u4E3B%u8981%u662F%u4E1A%u52A1%u76F8%u5173%u7684%u4E00%u4E9B%u901A%u7528%u51FD%u6570%uFF0C%u4EE5%u53CA%u901A%u7528%u6570%u636E%uFF0C%u5C06%u4F1A%u4FDD%u5B58%u5230%u8FD9%u4E2A%u7C7B%uFF0C%u5B83%u63D0%u4F9B%u4E00%u4E9B%u901A%u7528%u4E8B%u4EF6%u7ED1%u5B9A%u7B49%u3002%0A%0A%60pwi.jsListener.js%60%u901A%u7528%u6A21%u5757%uFF0C%u6B64%u6587%u4EF6%u4E3B%u8981%u66B4%u9732%u5168%u5C40%u51FD%u6570%uFF0C%u5C06c++%u7A0B%u5E8F%u6BB5%u56DE%u8C03%u7684%u51FD%u6570%uFF0C%u8F6C%u6362%u4E3Ajs%u4E8B%u4EF6%uFF0C%u5177%u4F53%u4F7F%u7528%u65B9%u6CD5%uFF1A%0A%0A%60%60%60%0Avar%20jqExt%20%3D%20%24%28jsListener%29%3B%0AjqExt.on%28%22DeviceChanged%22%2C%20function%28%29%7B%0A%20%20%20%20//%20do%20something%0A%7D%29%3B%0A%0A//%20%u4E0B%u8F7D%u901A%u77E5%u4E8B%u4EF6%uFF0C%u56DE%u8C03%u7B2C%u4E00%u4E2A%u53C2%u6570%u4E3AEvent%u5BF9%u8C61%uFF0C%u540E%u7EED%u7684%u53C2%u6570%u624D%u662Fc++%u8FD4%u56DE%u503C%0AjqExt.on%28%22DownloadStateChanged%22%2C%20function%28%29%7B%0A%20%20%20%20//%20%u66F4%u65B0%u754C%u9762%u6309%u94AE%u6837%u5F0F%u7B49...%0A%7D%29%3B%0A%60%60%60%0A%0A%23%23%u6A21%u677F%u4F7F%u7528%0A%0A%u7ECF%u8FC7%u4E0A%u4E00%u6B21%u4F1A%u8BAE%u8BA8%u8BBA%uFF0C%u6A21%u677F%u4F7F%u7528%u4E86arttemplate%u7684simple%20template%u8BED%u6CD5%uFF0C%u8BE6%u7EC6%u8BED%u6CD5%u8BF7%u53C2%u8003arttemplate%20github%u9875%u9762%0A%u4F7F%u7528tmod%20grunt%u63D2%u4EF6%u5BF9%u6A21%u677F%u8FDB%u884C%u9884%u7F16%u8BD1%u5904%u7406%0A%u6240%u6709template%u81F3%u4E8Ecommon/tpl%u76EE%u5F55%u4E2D%uFF0C%u6839%u636E%u6A21%u5757%u5EFA%u7ACB%u76F8%u5E94%u7684%u5B50%u76EE%u5F55%0A%u7531%u4E8E%u6A21%u677F%u5927%u540C%u5C0F%u5F02%uFF0C%u5F88%u591A%u6A21%u677F%u8D8A%u72F1%u548C%u6B63%u7248%u90FD%u662F%u540C%u7528%u7684%uFF0C%u56E0%u6B64%uFF0C%u6A21%u677F%u90FD%u7F16%u8BD1%u4E00%u8D77%uFF0C%u6210%u4E3A%u4E00%u4E2Atemplate.js%u6587%u4EF6%0A%0A%23%23%u4F18%u5316%0A%u6B64%u6B21%u91CD%u6784%u6240%u505A%u7684%u4F18%u5316%u5305%u62EC%0A1.%20css%u653E%u5728%u9875%u9762%u5934%u90E8%uFF0Cjs%u5168%u90E8%u653E%u5230%u5E95%u90E8%0A2.%20%u670D%u52A1%u5668%u8FD4%u56DEindex.html%u7684%u540C%u65F6%u5C31%u52A0%u8F7Dppajax%u7684iframe%uFF0C%u800C%u4E0D%u662Fdom%20ready%u4E4B%u540E%u52A0%u8F7Diframe%0A3.%20%u53BB%u9664%u6240%u6709document.writeln%u51FD%u6570%uFF0C%u4F7F%24%28document%29.ready%u4E8B%u4EF6%u63D0%u524D%u89E6%u53D1%uFF0C%u52A0%u8F7D%u9875%u9762%u6570%u636E%0A4.%20%u7EDF%u8BA1%u4EE3%u7801%u79FB%u52A8%u5230%u9875%u9762%u6700%u5E95%u90E8%uFF0C%u4E1A%u52A1js%u4E4B%u540E%uFF0C%u7EDF%u8BA1%u4EE3%u7801%u4E0D%u5E94%u8BE5%u5F71%u54CD%u4E1A%u52A1%u5448%u73B0%0A5.%20%u4F7F%u7528Gruntjs%2C%20%u5F15%u5165%60%u6784%u5EFA%60%u6D41%u7A0B%uFF0C%u53D1%u5E03%u6B63%u5F0F%u73AF%u5883%u9700%u8981%u5BF9%u6E90%u4EE3%u7801%u8FDB%u884C%u6784%u5EFA%uFF0C%u5177%u4F53%u53C2%u8003%u53E6%u5916%u4E00%u7BC7%u6587%u7AE0%u300Agrunt%u5B9E%u73B0%u9879%u76EE%u6784%u5EFA%u300B%0A%0A%0A</center><br/></div>
</div></body></html> 